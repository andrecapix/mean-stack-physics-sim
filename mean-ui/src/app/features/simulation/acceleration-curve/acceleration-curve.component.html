<div class="acceleration-curve-container">
  <mat-card class="config-card">
    <mat-card-header>
      <mat-card-title>Acceleration Curve Configuration</mat-card-title>
      <mat-card-subtitle>Configure parameters to generate the acceleration curve by velocity</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content>
      <form [formGroup]="curveForm" class="curve-form">
        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Threshold Velocity (km/h)</mat-label>
            <input matInput type="number" formControlName="linearVelocityThreshold" step="1">
            <mat-hint>Velocity up to which acceleration is constant</mat-hint>
            <mat-error *ngIf="curveForm.get('linearVelocityThreshold')?.hasError('required')">
              Required field
            </mat-error>
            <mat-error *ngIf="curveForm.get('linearVelocityThreshold')?.hasError('min')">
              Minimum value: 1 km/h
            </mat-error>
            <mat-error *ngIf="curveForm.get('linearVelocityThreshold')?.hasError('max')">
              Maximum value: 100 km/h
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Initial Acceleration (m/s²)</mat-label>
            <input matInput type="number" formControlName="initialAcceleration" step="0.1">
            <mat-hint>Constant acceleration up to threshold velocity</mat-hint>
            <mat-error *ngIf="curveForm.get('initialAcceleration')?.hasError('required')">
              Required field
            </mat-error>
            <mat-error *ngIf="curveForm.get('initialAcceleration')?.hasError('min')">
              Minimum value: 0.1 m/s²
            </mat-error>
            <mat-error *ngIf="curveForm.get('initialAcceleration')?.hasError('max')">
              Maximum value: 3.0 m/s²
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Velocity Increment (km/h)</mat-label>
            <input matInput type="number" formControlName="velocityIncrement" step="0.1">
            <mat-hint>Curve calculation interval</mat-hint>
            <mat-error *ngIf="curveForm.get('velocityIncrement')?.hasError('required')">
              Required field
            </mat-error>
            <mat-error *ngIf="curveForm.get('velocityIncrement')?.hasError('min')">
              Minimum value: 0.1 km/h
            </mat-error>
            <mat-error *ngIf="curveForm.get('velocityIncrement')?.hasError('max')">
              Maximum value: 10 km/h
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Loss Factor</mat-label>
            <input matInput type="number" formControlName="lossFactor" step="1">
            <mat-hint>Acceleration reduction factor</mat-hint>
            <mat-error *ngIf="curveForm.get('lossFactor')?.hasError('required')">
              Required field
            </mat-error>
            <mat-error *ngIf="curveForm.get('lossFactor')?.hasError('min')">
              Minimum value: 1
            </mat-error>
            <mat-error *ngIf="curveForm.get('lossFactor')?.hasError('max')">
              Maximum value: 1000
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-row">
          <mat-form-field appearance="outline">
            <mat-label>Maximum Velocity (km/h)</mat-label>
            <input matInput type="number" formControlName="maxVelocity" step="10">
            <mat-hint>Upper limit for curve calculation</mat-hint>
            <mat-error *ngIf="curveForm.get('maxVelocity')?.hasError('required')">
              Required field
            </mat-error>
            <mat-error *ngIf="curveForm.get('maxVelocity')?.hasError('min')">
              Minimum value: 10 km/h
            </mat-error>
            <mat-error *ngIf="curveForm.get('maxVelocity')?.hasError('max')">
              Maximum value: 300 km/h
            </mat-error>
          </mat-form-field>
        </div>

        <div class="form-actions">
          <button mat-raised-button color="primary" (click)="calculateCurve()" [disabled]="!curveForm.valid || isCalculating">
            <mat-icon>calculate</mat-icon>
            Calculate Curve
          </button>
          <button mat-raised-button (click)="resetForm()">
            <mat-icon>refresh</mat-icon>
            Reset
          </button>
          <button mat-raised-button color="accent" (click)="saveCurveConfiguration()" [disabled]="!curveForm.valid || curvePoints.length === 0">
            <mat-icon>save</mat-icon>
            Save Configuration
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>

  <div class="results-section" *ngIf="curvePoints.length > 0">
    <mat-card class="chart-card">
      <mat-card-header>
        <mat-card-title>Curve Visualization</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="chart-container">
          <canvas #chartCanvas></canvas>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="table-card">
      <mat-card-header>
        <mat-card-title>Calculated Values</mat-card-title>
        <button mat-icon-button (click)="exportToCSV()" matTooltip="Export to CSV" class="export-button">
          <mat-icon>download</mat-icon>
        </button>
      </mat-card-header>
      <mat-card-content>
        <div class="table-container">
          <table mat-table [dataSource]="curvePoints" class="values-table">
            <ng-container matColumnDef="velocity">
              <th mat-header-cell *matHeaderCellDef> Velocity (km/h) </th>
              <td mat-cell *matCellDef="let point"> {{point.velocity.toFixed(1)}} </td>
            </ng-container>

            <ng-container matColumnDef="acceleration">
              <th mat-header-cell *matHeaderCellDef> Acceleration (m/s²) </th>
              <td mat-cell *matCellDef="let point"> {{point.acceleration.toFixed(6)}} </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
          </table>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <div class="loading-overlay" *ngIf="isCalculating">
    <mat-progress-spinner mode="indeterminate" diameter="50"></mat-progress-spinner>
    <p>Calculating curve...</p>
  </div>
</div>